"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getChangedFilePaths = void 0;
const getCanonicalFileName_1 = require("../../Shared/util/getCanonicalFileName");
const getOrSetDefault_1 = require("../../Shared/util/getOrSetDefault");
function getChangedFilePaths(program, pathHints) {
    var _a, _b;
    const compilerOptions = program.getCompilerOptions();
    const buildState = program.getState();
    const reversedReferencedMap = new Map();
    (_a = buildState.referencedMap) === null || _a === void 0 ? void 0 : _a.forEach((referencedSet, filePath) => {
        referencedSet.forEach((_, refFilePath) => {
            (0, getOrSetDefault_1.getOrSetDefault)(reversedReferencedMap, refFilePath, () => new Set()).add(filePath);
        });
    });
    const changedFilesSet = new Set();
    const search = (filePath) => {
        var _a;
        changedFilesSet.add(filePath);
        (_a = reversedReferencedMap.get(filePath)) === null || _a === void 0 ? void 0 : _a.forEach(refFilePath => {
            if (!changedFilesSet.has(refFilePath)) {
                changedFilesSet.add(refFilePath);
                if (compilerOptions.assumeChangesOnlyAffectDirectDependencies !== true) {
                    search(refFilePath);
                }
            }
        });
    };
    if (pathHints) {
        for (const hint of pathHints) {
            search((0, getCanonicalFileName_1.getCanonicalFileName)(hint));
        }
    }
    else {
        (_b = buildState.changedFilesSet) === null || _b === void 0 ? void 0 : _b.forEach((_, fileName) => search(fileName));
    }
    return changedFilesSet;
}
exports.getChangedFilePaths = getChangedFilePaths;
//# sourceMappingURL=getChangedFilePaths.js.map